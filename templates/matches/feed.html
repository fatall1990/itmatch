{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ñ–∏–ª—å—Ç—Ä—ã -->
        <div class="col-lg-3 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">–§–∏–ª—å—Ç—Ä—ã</h5>
                </div>
                <div class="card-body">
                    <form method="get" id="filter-form">
                        <div class="mb-3">
                            <label class="form-label">–†–æ–ª—å</label>
                            <select name="role" class="form-select">
                                <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                                <option value="frontend">Frontend Developer</option>
                                <option value="backend">Backend Developer</option>
                                <option value="fullstack">Fullstack Developer</option>
                                <option value="mobile">Mobile Developer</option>
                                <option value="devops">DevOps Engineer</option>
                                <option value="data">Data Scientist</option>
                                <option value="designer">UX/UI Designer</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–£—Ä–æ–≤–µ–Ω—å</label>
                            <select name="level" class="form-select">
                                <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
                                <option value="junior">Junior</option>
                                <option value="middle">Middle</option>
                                <option value="senior">Senior</option>
                                <option value="lead">Team Lead</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</label>
                            <select name="work_mode" class="form-select">
                                <option value="">–õ—é–±–æ–π</option>
                                <option value="remote">–£–¥–∞–ª—ë–Ω–Ω–æ</option>
                                <option value="office">–û—Ñ–∏—Å</option>
                                <option value="hybrid">–ì–∏–±—Ä–∏–¥</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</label>
                            <input type="text" name="technologies" class="form-control" 
                                   placeholder="Python, React...">
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-outline-secondary mt-2" 
                                    onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="card mt-4">
                <div class="card-body text-center">
                    <h5>–í–∞—à–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</h5>
                    <div class="display-4 text-primary">{{ matches_count }}</div>
                    <a href="{% url 'matches:matches_list' %}" class="btn btn-outline-primary btn-sm mt-2">
                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                    </a>
                </div>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ª–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>–õ–µ–Ω—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h2>
                <div class="badge bg-primary p-2">
                    –ü–æ–∫–∞–∑–∞–Ω–æ: {{ users|length }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                </div>
            </div>
            
            {% if users %}
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div class="card mb-4 user-card" id="current-user-card">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center">
                                {% if users.0.user.avatar %}
                                    <img src="{{ users.0.user.avatar.url }}" 
                                         class="rounded-circle mb-3" width="120" height="120">
                                {% else %}
                                    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                                         style="width: 120px; height: 120px;">
                                        <i class="bi bi-person" style="font-size: 50px; color: #6c757d;"></i>
                                    </div>
                                {% endif %}
                                
                                <div class="compatibility-badge">
                                    <span class="badge {% if users.0.compatibility_score > 70 %}bg-success{% elif users.0.compatibility_score > 40 %}bg-warning{% else %}bg-secondary{% endif %}">
                                        –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {{ users.0.compatibility_score }}%
                                    </span>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h4>{{ users.0.user.get_full_name|default:users.0.user.username }}</h4>
                                
                                <div class="mb-3">
                                    {% if users.0.user.role %}
                                        <span class="badge bg-primary">{{ users.0.user.get_role_display }}</span>
                                    {% endif %}
                                    {% if users.0.user.level %}
                                        <span class="badge bg-info">{{ users.0.user.get_level_display }}</span>
                                    {% endif %}
                                    {% if users.0.user.work_mode %}
                                        <span class="badge bg-secondary">{{ users.0.user.get_work_mode_display }}</span>
                                    {% endif %}
                                </div>
                                
                                {% if users.0.user.city %}
                                    <p><i class="bi bi-geo-alt"></i> {{ users.0.user.city }}</p>
                                {% endif %}
                                
                                {% if users.0.user.experience_years > 0 %}
                                    <p><i class="bi bi-briefcase"></i> {{ users.0.user.experience_years }} –ª–µ—Ç –æ–ø—ã—Ç–∞</p>
                                {% endif %}
                                
                                {% if users.0.user.bio %}
                                    <p class="text-muted">{{ users.0.user.bio|truncatechars:150 }}</p>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-3">
                                <!-- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ -->
                                <h6>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:</h6>
                                <div class="mb-3">
                                    {% for tech in users.0.tech_list %}
                                        <span class="badge bg-light text-dark border mb-1">{{ tech }}</span>
                                    {% endfor %}
                                    {% if users.0.user.technologies and users.0.tech_list|length == 5 %}
                                        <span class="badge bg-light text-dark border">...</span>
                                    {% endif %}
                                </div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                                <div class="action-buttons">
                                    <button class="btn btn-danger btn-lg dislike-btn" 
                                            onclick="sendDislike({{ users.0.user.id }})">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                    <button class="btn btn-success btn-lg like-btn" 
                                            onclick="sendLike({{ users.0.user.id }})">
                                        <i class="bi bi-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –°–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ø—Ä–µ–≤—å—é) -->
                <div class="row">
                    {% for user_data in users|slice:"1:7" %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 user-preview-card">
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    {% if user_data.user.avatar %}
                                        <img src="{{ user_data.user.avatar.url }}" 
                                             class="rounded-circle mb-2" width="80" height="80">
                                    {% else %}
                                        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-2" 
                                             style="width: 80px; height: 80px;">
                                            <i class="bi bi-person" style="font-size: 30px; color: #6c757d;"></i>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="small">
                                        <span class="badge {% if user_data.compatibility_score > 70 %}bg-success{% elif user_data.compatibility_score > 40 %}bg-warning{% else %}bg-secondary{% endif %}">
                                            {{ user_data.compatibility_score }}%
                                        </span>
                                    </div>
                                </div>
                                
                                <h6 class="text-center">{{ user_data.user.username }}</h6>
                                
                                <div class="text-center mb-2">
                                    {% if user_data.user.role %}
                                        <span class="badge bg-primary small">{{ user_data.user.get_role_display|slice:":10" }}</span>
                                    {% endif %}
                                </div>
                                
                                {% if user_data.user.city %}
                                    <p class="text-center small text-muted">
                                        <i class="bi bi-geo-alt"></i> {{ user_data.user.city }}
                                    </p>
                                {% endif %}
                                
                                <div class="text-center">
                                    {% for tech in user_data.tech_list|slice:":3" %}
                                        <span class="badge bg-light text-dark border small mb-1">{{ tech }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è/–∑–∞–≥—Ä—É–∑–∫–∞ -->
                <div class="text-center mt-4">
                    <button class="btn btn-outline-primary" onclick="loadMoreUsers()">
                        <i class="bi bi-arrow-clockwise"></i> –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ
                    </button>
                </div>
                
            {% else %}
                <!-- –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="bi bi-people display-1 text-muted mb-3"></i>
                        <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                        <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –∑–∞–π–¥–∏—Ç–µ –ø–æ–∑–∂–µ</p>
                        <a href="{% url 'matches:feed' %}" class="btn btn-primary">
                            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –º—ç—Ç—á–∞ -->
<div class="modal fade" id="matchModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">üéâ –í–∑–∞–∏–º–Ω–∞—è —Å–∏–º–ø–∞—Ç–∏—è!</h5>
            </div>
            <div class="modal-body text-center p-5">
                <div class="match-animation mb-4">
                    <div class="hearts-container">
                        <i class="bi bi-heart-fill heart heart-1"></i>
                        <i class="bi bi-heart-fill heart heart-2"></i>
                        <i class="bi bi-heart-fill heart heart-3"></i>
                    </div>
                </div>

                <h3 class="mb-3">–≠—Ç–æ –≤–∑–∞–∏–º–Ω–æ!</h3>
                <p class="mb-4">–í—ã –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –¥—Ä—É–≥ –¥—Ä—É–≥—É. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è!</p>
                <p class="text-muted small mb-4">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑: <span id="countdown">3</span> —Å–µ–∫.</p>

                <div class="d-flex flex-column gap-3">
                    <button class="btn btn-primary btn-lg" onclick="goToMatches()">
                        <i class="bi bi-chat-dots"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º
                    </button>
                    <button class="btn btn-outline-primary" onclick="continueSwiping()">
                        <i class="bi bi-arrow-right"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .user-card {
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        transition: transform 0.2s;
    }
    
    .user-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .user-preview-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .user-preview-card:hover {
        border-color: #667eea;
        transform: translateY(-3px);
    }
    
    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }
    
    .like-btn, .dislike-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        border: none;
        transition: transform 0.2s;
    }
    
    .like-btn:hover {
        transform: scale(1.1);
        background-color: #198754 !important;
    }
    
    .dislike-btn:hover {
        transform: scale(1.1);
        background-color: #dc3545 !important;
    }
    
    .compatibility-badge {
        margin-top: 10px;
    }
    
    .match-hearts i {
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .match-animation {
        position: relative;
        height: 100px;
    }

    .hearts-container {
        position: relative;
        width: 200px;
        height: 100px;
        margin: 0 auto;
    }

    .heart {
        position: absolute;
        color: #ff6b6b;
        font-size: 3rem;
        animation: float 2s ease-in-out infinite;
    }

    .heart-1 {
        left: 20%;
        animation-delay: 0s;
    }

    .heart-2 {
        left: 50%;
        transform: translateX(-50%);
        font-size: 4rem;
        animation-delay: 0.2s;
    }

    .heart-3 {
        right: 20%;
        animation-delay: 0.4s;
    }

    @keyframes float {
        0%, 100% {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        50% {
            transform: translateY(-20px) scale(1.1);
            opacity: 0.8;
        }
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
        }
        70% {
            transform: scale(1.05);
            box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
        }
        100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
        }
    }

    .modal-content {
        animation: pulse 2s infinite;
        border: 3px solid #ff6b6b;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .modal.fade .modal-dialog {
        animation: fadeIn 0.3s ease-out;
    }
</style>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
    function getCSRFToken() {
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
    let countdownInterval;
    let countdownValue = 60;

    // –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    function startCountdown() {
        countdownValue = 60;
        const countdownElement = document.getElementById('countdown');
        if (countdownElement) {
            countdownElement.textContent = countdownValue;
        }

        countdownInterval = setInterval(() => {
            countdownValue--;
            if (countdownElement) {
                countdownElement.textContent = countdownValue;
            }

            if (countdownValue <= 0) {
                clearInterval(countdownInterval);
                const modal = bootstrap.Modal.getInstance(document.getElementById('matchModal'));
                if (modal) {
                    modal.hide();
                }
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                setTimeout(() => {
                    window.location.reload();
                }, 300);
            }
        }, 1000);
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º
    function goToMatches() {
        clearInterval(countdownInterval);
        const modal = bootstrap.Modal.getInstance(document.getElementById('matchModal'));
        if (modal) {
            modal.hide();
        }
        setTimeout(() => {
            window.location.href = "{% url 'matches:matches_list' %}";
        }, 300);
    }

    // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä
    function continueSwiping() {
        clearInterval(countdownInterval);
        const modal = bootstrap.Modal.getInstance(document.getElementById('matchModal'));
        if (modal) {
            modal.hide();
        }
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        setTimeout(() => {
            window.location.reload();
        }, 300);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∞–π–∫–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function sendLike(userId) {
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∞–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', userId);

        const csrfToken = getCSRFToken();

        // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è
        const likeBtn = document.querySelector('.like-btn');
        const dislikeBtn = document.querySelector('.dislike-btn');
        likeBtn.disabled = true;
        dislikeBtn.disabled = true;
        likeBtn.innerHTML = '<i class="bi bi-heart-fill"></i>';

        fetch(`/matches/like/${userId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);

            if (data.success) {
                if (data.has_match) {
                    console.log('–ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ!');

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ—Ç—Å—á–µ—Ç
                    const matchModalElement = document.getElementById('matchModal');
                    const matchModal = new bootstrap.Modal(matchModalElement);

                    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    matchModalElement.addEventListener('shown.bs.modal', function () {
                        startCountdown();
                    });

                    matchModal.show();

                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            } else {
                alert(data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ
                likeBtn.disabled = false;
                dislikeBtn.disabled = false;
                likeBtn.innerHTML = '<i class="bi bi-heart"></i>';
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ª–∞–π–∫–∞');
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ
            likeBtn.disabled = false;
            dislikeBtn.disabled = false;
            likeBtn.innerHTML = '<i class="bi bi-heart"></i>';
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∏–∑–ª–∞–π–∫–∞ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ —É–ª—É—á—à–∞–µ–º)
    function sendDislike(userId) {
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∏–∑–ª–∞–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', userId);

        const csrfToken = getCSRFToken();

        // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏
        const likeBtn = document.querySelector('.like-btn');
        const dislikeBtn = document.querySelector('.dislike-btn');
        likeBtn.disabled = true;
        dislikeBtn.disabled = true;
        dislikeBtn.innerHTML = '<i class="bi bi-check-lg"></i>';

        fetch(`/matches/dislike/${userId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            console.log('–û—Ç–≤–µ—Ç –¥–∏–∑–ª–∞–π–∫–∞:', data);

            if (data.success) {
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    window.location.reload();
                }, 500);
            } else {
                alert(data.error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ
                likeBtn.disabled = false;
                dislikeBtn.disabled = false;
                dislikeBtn.innerHTML = '<i class="bi bi-x-lg"></i>';
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∏–∑–ª–∞–π–∫–∞');
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ
            likeBtn.disabled = false;
            dislikeBtn.disabled = false;
            dislikeBtn.innerHTML = '<i class="bi bi-x-lg"></i>';
        });
    }
</script>
{% endblock %}